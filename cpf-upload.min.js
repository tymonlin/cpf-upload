!function(l){var e=l.module("module.cloudpayfull.upload",["angularFileUpload"]);e.directive("cpfUpload",function(){return{restrict:"EA",scope:{config:"@",callBack:"&",uploadUrl:"="},replace:!0,template:"<div class='container-fluid cpf-upload'>    <input type='file' id='uploadFile'  nv-file-select='' uploader='uploader'>    <div class='row' nv-file-drop='' uploader='uploader' onclick='$(this).parent().children(\"input\").eq(0).click();'         ng-if='uploader.queue.length < _config.maxCount && uploader.isHTML5'>        <div nv-file-over='' uploader='uploader' over-class='another-file-over-class' class='well my-drop-zone'>            拖拽或点击上传<hr/>（请选择<span ng-repeat='ext in _config.extensions'>.{{ext}},</span> 格式文件上传）        </div>    </div>    <div class='row well' ng-repeat='item in uploader.queue'>        <div class='col-xs-10 col-lg-11' style=''>            <div class='row'>                <label class='col-xs-9'>文件名: {{item.file.name}}</label>                <div class='col-xs-3 text-right'>{{ item.file.size | dataSize }}</div>            </div>            <div class='row' ng-show='!item.isSuccess && !item.isUploading'>                <button ng-click='item.upload()' class='btn btn-success form-control'                    ng-disabled='item.isReady || item.isUploading || item.isSuccess' >上传</button>            </div>            <div class='row' ng-show='item.isSuccess || item.isUploading'>                <div class='progress' style='height: 28px; background-color: #EEEEEE'>                    <div class='progress-bar' role='progressbar' ng-style=\"{ 'width': item.progress + '%' }\">                        <span ng-if='item.isUploading'>{{item.progress}}%</span>                        <span ng-show='item.isSuccess'><i class='glyphicon glyphicon-ok'></i>上传成功</span>                    </div>                </div>            </div>        </div>        <div class='col-xs-2 col-lg-1'>            <button type='button' class='btn btn-danger btn-lg' ng-click='removeItem(item)'><i class='fa fa-trash-o fa-3x'></i></button>        </div>    </div></div>",controller:["$scope","FileUploader","$CPFUpload",function(n,e,s){var o={extensions:s.fileExtensions,tokenKey:s.tokenKey,maxCount:s.maxCount},i={};n.config&&(i=JSON.parse(n.config)),n._config=o=l.extend(o,i);var t=n.uploader=new e({});o.token&&o.tokenKey&&(t.headers[o.tokenKey]=o.token),n.$watch("uploadUrl",function(){t.url=n.uploadUrl}),t.filters.push({name:"extensionFilter",fn:function(e,i){var t=s.checkExtension(o.extensions,e.name);return t||n.callBack({result:!1,errorCode:"10",message:"不支持此文件类型"})}},{name:"fileCountFilter",fn:function(e){for(var i=0;i<this.queue.length;i++)if(this.queue[i].file.name==e.name&&this.queue[i].file.size==e.size&&this.queue[i].file.lastModified==e.lastModified)return!1;return!(this.queue.length>o.maxCount)||n.callBack({result:!1,errorCode:"11",message:"只能上传 "+o.maxCount+" 个文件！"})}}),n.removeItem=function(e){n.forbidConfirm=!0,e.cancel(),e.remove()},n.checkFileName=function(){var e=n.fileName;if("object"==typeof n.fileExtensions)return s.checkExtension(n.fileExtensions,e)},t.onCompleteItem=function(e,i,t,s){200!=t&&0!=t?n.callBack({result:!1,errorCode:"09",message:i.message}):n.callBack({result:!0,response:i})}}]}}),e.provider("$CPFUpload",function(){this.tokenKey="WEB-TOKEN",this.maxCount=1,this.officeExtensions=["xls","xlsx","doc","docx","ppt","pptx"],this.zipExtensions=["zip","rar","7z"],this.imgExtensions=["jpg","jpeg","bmp","gif","png"],this.pdfExtensions=["pdf"],this.otherExtensions=["txt"],this.fileExtensions=["xls","xlsx","doc","docx","ppt","pptx","zip","rar","7z","jpg","jpeg","bmp","gif","png","pdf","txt"],this.checkExtension=function(e,i){for(var t=i.substring(i.lastIndexOf(".")+1).toLowerCase(),s=0;s<e.length;s++){if(e[s].toLowerCase()==t.toLowerCase())return!0}return!1},this.$get=function(){return this}}),e.filter("dataSize",function(){return function(e){for(var i=e,t="byte";1e3<i;)if(i/=1e3,"byte"==t)t="Kb";else if("Kb"==t)t="Mb";else if("Mb"==t){t="Gb";break}return i.toFixed(2)+" "+t}})}(angular);