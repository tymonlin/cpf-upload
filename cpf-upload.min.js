!function(t){var e=t.module("module.cloudpayfull.upload",["angularFileUpload"]);e.directive("cpfUpload",function(){return{restrict:"EA",scope:{config:"@",callBack:"&"},replace:!0,template:"<div class='container-fluid cpf-upload'>    <input type='file' οnchange='angular.element(this).scope().fileChange(this);' nv-file-select='' uploader='uploader'>    <input type='text' ng-change='checkFileName()' ng-model='fileName'>    <div class='row' nv-file-drop='' uploader='uploader' onclick='$(this).parent().children(\"input\").eq(0).click();' ng-if='uploader.queue.length < _config.maxCount && uploader.isHTML5'>        <div nv-file-over='' uploader='uploader' over-class='another-file-over-class' class='well my-drop-zone'>            拖拽或点击上传<hr/>（请选择<span ng-repeat='ext in _config.extensions'>.{{ext}},</span> 格式文件上传）        </div>    </div>    <div class='row well' ng-repeat='item in uploader.queue'>        <div class='col-xs-10 col-lg-11' style=''>            <div class='row'>                <label class='col-xs-9'>文件名: {{item.file.name}}</label>                <div class='col-xs-3 text-right'>{{ item.file.size | dataSize }}</div>            </div>            <div class='row' ng-show='!item.isSuccess && !item.isUploading'>                <button ng-click='item.upload()' class='btn btn-success form-control'                    ng-disabled='item.isReady || item.isUploading || item.isSuccess' >上传</button>            </div>            <div class='row' ng-show='item.isSuccess || item.isUploading'>                <div class='progress' style='height: 28px; background-color: #EEEEEE'>                    <div class='progress-bar' role='progressbar' ng-style=\"{ 'width': item.progress + '%' }\">                        <span ng-if='item.isUploading'>{{item.progress}}%</span>                        <span ng-show='item.isSuccess'><i class='glyphicon glyphicon-ok'></i>上传成功</span>                    </div>                </div>            </div>        </div>        <div class='col-xs-2 col-lg-1'>            <button type='button' class='btn btn-danger btn-lg' ng-click='removeItem(item)'><i class='fa fa-trash-o fa-3x'></i></button>        </div>    </div></div>",controller:["$scope","FileUploader","$CPFUpload",function(s,e,n){var o={extensions:n.fileExtensions,tokenKey:n.tokenKey,uploadUrl:"/",maxCount:n.maxCount},o=t.extend(o,JSON.parse(s.config));s.fileChange=function(e){var i=e.value;$("#fileName").val(i).trigger("change")},s._config=o;var i=s.uploader=new e({});o.token&&o.tokenKey&&(i.headers[o.tokenKey]=o.token),null==o.uploadUrl||o.uploadUrl,i.url=o.uploadUrl,i.filters.push({name:"extensionFilter",fn:function(e,i){var t=n.checkExtension(o.extensions,e.name);return t||s.callBack({result:!1,errorCode:"10",message:"不支持此文件类型"})}},{name:"fileCountFilter",fn:function(e){for(var i=0;i<this.queue.length;i++)if(this.queue[i].file.name==e.name&&this.queue[i].file.size==e.size&&this.queue[i].file.lastModified==e.lastModified)return!1;return!(this.queue.length>o.maxCount)||s.callBack({result:!1,errorCode:"11",message:"只能上传 "+o.maxCount+" 个文件！"})}}),s.removeItem=function(e){s.forbidConfirm=!0,e.cancel(),e.remove()},s.checkFileName=function(){var e=s.fileName;if("object"==typeof s.fileExtensions)return n.checkExtension(s.fileExtensions,e)},i.onCompleteItem=function(e,i,t,n){200!=t&&0!=t?s.callBack({result:!1,errorCode:"09",message:i.message}):s.callBack({result:!0,response:i})}}]}}),e.provider("$CPFUpload",function(){this.tokenKey="WEB-TOKEN",this.maxCount=3,this.officeExtensions=["xls","xlsx","doc","docx","ppt","pptx"],this.zipExtensions=["zip","rar","7z"],this.imgExtensions=["jpg","jpeg","bmp","gif","png"],this.pdfExtensions=["pdf"],this.otherExtensions=["txt"],this.fileExtensions=["xls","xlsx","doc","docx","ppt","pptx","zip","rar","7z","jpg","jpeg","bmp","gif","png","pdf","txt"],this.checkExtension=function(e,i){for(var t=i.substring(i.lastIndexOf(".")+1).toLowerCase(),n=0;n<e.length;n++){if(e[n].toLowerCase()==t.toLowerCase())return!0}return!1},this.$get=function(){return this}}),e.filter("dataSize",function(){return function(e){for(var i=e,t="byte";1e3<i;)if(i/=1e3,"byte"==t&&(t="Kb"),"Kb"==t&&(t="Mb"),"Mb"==t){t="Gb";break}return i.toFixed(2)+" "+t}})}(angular);